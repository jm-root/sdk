{"version":3,"file":"jm-sdk.js","sources":["../../jm-sdk-core/dist/index.esm.js","../lib/config.js","../lib/sso.js","../lib/passport.js","../lib/login.js","../lib/index.js"],"sourcesContent":["import jmEvent from 'jm-event';\nimport jmModule from 'jm-module';\nimport jmLogger from 'jm-logger';\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nvar reservedKeys = ['_events', '_state', 'state'];\n\nfunction validKey(key) {\n  return reservedKeys.indexOf(key) === -1;\n}\n\nvar Store =\n/*#__PURE__*/\nfunction (_event$EventEmitter) {\n  _inherits(Store, _event$EventEmitter);\n\n  function Store() {\n    var _this;\n\n    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Store);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Store).call(this, opts));\n    _this._state = {};\n    return _this;\n  }\n\n  _createClass(Store, [{\n    key: \"listen\",\n    value: function listen() {\n      var _this2 = this;\n\n      for (var _len = arguments.length, keys = new Array(_len), _key = 0; _key < _len; _key++) {\n        keys[_key] = arguments[_key];\n      }\n\n      keys.forEach(function (key) {\n        if (!validKey(key)) throw new Error(\"\".concat(key, \" can not be listened\"));\n        Reflect.defineProperty(_this2, key, {\n          configurable: true,\n          enumerable: true,\n          get: function get() {\n            var value = _this2._state[key];\n\n            _this2.emit('get', key, value);\n\n            return value;\n          },\n          set: function set(value) {\n            _this2._state[key] = value;\n\n            _this2.emit('set', key, value);\n          }\n        });\n      });\n      return this;\n    }\n  }, {\n    key: \"state\",\n    get: function get() {\n      var value = Object.assign({}, this._state, this);\n      reservedKeys.forEach(function (key) {\n        delete value[key];\n      });\n      this.emit('get', 'state', value);\n      return value;\n    },\n    set: function set(value) {\n      var _this3 = this;\n\n      this.emit('set', 'state', value);\n      Object.keys(this).forEach(function (key) {\n        if (!validKey(key)) return;\n        var d = Reflect.getOwnPropertyDescriptor(_this3, key);\n        if (d && d.set && d.get) return;\n        delete _this3[key];\n      });\n      this._state = {};\n      Object.keys(value).forEach(function (key) {\n        _this3[key] = value[key];\n      });\n    }\n  }]);\n\n  return Store;\n}(jmEvent.EventEmitter);\n\nvar store = Store;\n\nvar Store$1 =\n/*#__PURE__*/\nfunction () {\n  function Store() {\n    _classCallCheck(this, Store);\n\n    jmEvent.enableEvent(this);\n    this.store = {};\n  }\n\n  _createClass(Store, [{\n    key: \"setItem\",\n    value: function setItem(k, v) {\n      this.emit('setItem', k, v);\n      this.store[k] = v;\n    }\n  }, {\n    key: \"getItem\",\n    value: function getItem(k, defaultV) {\n      var v = this.store[k] || defaultV;\n      this.emit('getItem', k, v);\n      return v;\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(k) {\n      this.emit('removeItem', k);\n      delete this.store[k];\n    }\n  }, {\n    key: \"setJson\",\n    value: function setJson(k, o) {\n      this.emit('setJson', k, o);\n      this.setItem(k, JSON.stringify(o));\n    }\n  }, {\n    key: \"getJson\",\n    value: function getJson(k, defaultV) {\n      var v = this.getItem(k);\n      if (!v) return defaultV;\n      var o = JSON.parse(v) || defaultV;\n      this.emit('getJson', k, o);\n      return o;\n    }\n  }]);\n\n  return Store;\n}();\n\nvar Storage =\n/*#__PURE__*/\nfunction () {\n  function Storage() {\n    _classCallCheck(this, Storage);\n\n    jmEvent.enableEvent(this);\n  }\n\n  _createClass(Storage, [{\n    key: \"setItem\",\n    value: function setItem(k, v) {\n      this.emit('setItem', k, v);\n      localStorage.setItem(k, v);\n    }\n  }, {\n    key: \"getItem\",\n    value: function getItem(k, defaultV) {\n      var v = localStorage.getItem(k) || defaultV;\n      this.emit('getItem', k, v);\n      return v;\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(k) {\n      this.emit('removeItem', k);\n      localStorage.removeItem(k);\n    }\n  }, {\n    key: \"setJson\",\n    value: function setJson(k, o) {\n      this.emit('setJson', k, o);\n      this.setItem(k, JSON.stringify(o));\n    }\n  }, {\n    key: \"getJson\",\n    value: function getJson(k, defaultV) {\n      var v = this.getItem(k);\n      if (!v) return defaultV;\n      var o = JSON.parse(v) || defaultV;\n      this.emit('getJson', k, o);\n      return o;\n    }\n  }]);\n\n  return Storage;\n}();\n\nvar storage = null;\n\nif (typeof localStorage !== 'undefined') {\n  storage = new Storage();\n} else {\n  storage = new Store$1();\n}\n\nvar storage_1 = storage;\n\nvar Sdk = function Sdk() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  _classCallCheck(this, Sdk);\n\n  jmModule.enableModule(this);\n  jmEvent.enableEvent(this, {\n    async: true\n  });\n  this.logger = opts.logger || jmLogger.getLogger('sdk');\n  this.getLogger = opts.getLogger || jmLogger.getLogger;\n  this.store = opts.store || new store();\n  this.storage = opts.storage || storage_1;\n};\n\nvar lib = Sdk;\n\nexport default lib;\n//# sourceMappingURL=index.esm.js.map\n","const error = require('jm-err')\r\nconst {Err} = error\r\nconst name = 'config'\r\n\r\nmodule.exports = function (opts) {\r\n  let app = this\r\n  this.bind(name)\r\n  const $ = app[name]\r\n\r\n  /**\r\n   * 获取配置\r\n   * @param root 根(必填)\r\n   * @param key 配置项(必填)\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.getConfig = async function (root, key) {\r\n    if (!root || !key) throw error.err(Err.FA_PARAMS)\r\n    return this.get(`/${root}/${key}`)\r\n  }\r\n\r\n  /**\r\n   * 设置配置信息\r\n   * @param root 根(必填)\r\n   * @param key 配置项(必填)\r\n   * @param value 配置值(可选)\r\n   * @param expire 过期时间(可选, 单位秒, 默认0代表永不过期)\r\n   * @returns {Promise<void>}\r\n   */\r\n  $.setConfig = async function (root, key, value, expire = 0) {\r\n    if (!root || !key) throw error.err(Err.FA_PARAMS)\r\n    return this.post(`/${root}/${key}`, {value, expire})\r\n  }\r\n\r\n  /**\r\n   * 删除配置信息\r\n   * @param root 根(必填)\r\n   * @param key 配置项(必填)\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.removeConfig = async function (root, key) {\r\n    if (!root || !key) throw error.err(Err.FA_PARAMS)\r\n    return this.delete(`/${root}/${key}`)\r\n  }\r\n\r\n  /**\r\n   * 删除根配置, 所有根下面的配置信息都被删除\r\n   * @param root 根(必填)\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.removeRoot = async function (root) {\r\n    if (!root) throw error.err(Err.FA_PARAMS)\r\n    return this.delete(`/${root}`)\r\n  }\r\n\r\n  /**\r\n   * 列出配置项, 返回{rows:[]}\r\n   * @param root 根(必填)\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.getKeys = async function (root) {\r\n    if (!root) throw error.err(Err.FA_PARAMS)\r\n    return this.get(`/${root}`)\r\n  }\r\n\r\n  /**\r\n   * 列出配置项及值\r\n   * @param root 根(必填)\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.getConfigs = async function (root) {\r\n    if (!root) throw error.err(Err.FA_PARAMS)\r\n    return this.get(`/${root}?all=1`)\r\n  }\r\n\r\n  /**\r\n   * 设置多个配置信息\r\n   * @param root 根(必填)\r\n   * @param opts\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.setConfigs = async function (root, opts = {}) {\r\n    if (!root) throw error.err(Err.FA_PARAMS)\r\n    return this.post(`/${root}`, {value: opts})\r\n  }\r\n\r\n  return {\r\n    name,\r\n    unuse: () => {\r\n      delete app[name]\r\n    }\r\n  }\r\n}\r\n","const name = 'sso'\r\n\r\nmodule.exports = function (opts) {\r\n  let app = this\r\n  this.bind(name)\r\n  let $ = app[name]\r\n\r\n  $.verify = async function () {\r\n    const uri = '/verify'\r\n    return this.get(uri)\r\n  }\r\n\r\n  $.touch = async function (opts) {\r\n    const uri = '/touch'\r\n    return this.post(uri)\r\n  }\r\n\r\n  $.signout = async function () {\r\n    const uri = '/signout'\r\n    return this.get(uri)\r\n  }\r\n\r\n  return {\r\n    name,\r\n    unuse: () => {\r\n      delete app[name]\r\n    }\r\n  }\r\n}\r\n","const name = 'passport'\r\n\r\nmodule.exports = function (opts) {\r\n  let app = this\r\n  this.bind(name)\r\n  let $ = app[name]\r\n\r\n  $.login = async function (username, password) {\r\n    let uri = '/login'\r\n    return this.post(uri, {username, password})\r\n  }\r\n\r\n  return {\r\n    name,\r\n    unuse: () => {\r\n      delete app[name]\r\n    }\r\n  }\r\n}\r\n","const name = 'login'\r\n\r\nmodule.exports = function (opts) {\r\n  let app = this\r\n  let doLogin = null\r\n\r\n  async function checkOrLogin () {\r\n    let store = app.store\r\n    let storage = app.storage\r\n    let doc = storage.getJson('sso')\r\n    if (doc) {\r\n      store.sso = doc\r\n      try {\r\n        doc = await app.sso.verify()\r\n      } catch (e) {\r\n        doc = e.data || {}\r\n      }\r\n      if (!doc || !doc.token) {\r\n        delete store.sso.token // 删除token\r\n        doc = null\r\n      }\r\n    }\r\n    if (!doc) {\r\n      if (app.login) {\r\n        doc = await app.login()\r\n        if (doc && doc.token) {\r\n          storage.setJson('sso', doc)\r\n          store.sso = doc\r\n        }\r\n      }\r\n    } else {\r\n      storage.setJson('sso', doc)\r\n      store.sso = doc\r\n    }\r\n    return doc\r\n  }\r\n\r\n  app.checkLogin = async function () {\r\n    if (doLogin) return doLogin\r\n    doLogin = new Promise(\r\n      async (resolve, reject) => {\r\n        try {\r\n          let doc = await checkOrLogin()\r\n          resolve(doc)\r\n        } catch (e) {\r\n          reject(e)\r\n        }\r\n        doLogin = false\r\n      }\r\n    )\r\n    return doLogin\r\n  }\r\n\r\n  /**\r\n   * 判断是否已经登陆\r\n   */\r\n  app.isLoggedIn = function () {\r\n    return this.store.sso\r\n  }\r\n\r\n  /**\r\n   * 登出\r\n   */\r\n  app.logout = function () {\r\n    delete this.store.sso\r\n    this.storage.removeItem('sso')\r\n  }\r\n\r\n  return {\r\n    name,\r\n    unuse: () => {\r\n      delete app.checkLgoin\r\n      delete app.isLoggedIn\r\n      delete app.logout\r\n    }\r\n  }\r\n}\r\n","const event = require('jm-event')\nconst utils = require('jm-ms-core').utils\nconst Core = require('jm-sdk-core')\nconst config = require('./config')\nconst sso = require('./sso')\nconst passport = require('./passport')\nconst login = require('./login')\n\nconst types = ['get', 'post', 'put', 'delete', 'patch']\n\nclass Sdk extends Core {\n  constructor (opts = {}) {\n    super(opts)\n    this.ready = false\n    this.store.config = opts\n\n    types.forEach(type => {\n      this.bindType(this, type)\n    })\n\n    const mdls = {\n      config,\n      sso,\n      passport,\n      login\n    }\n    let modules = Object.assign({}, opts.modules)\n    Object.keys(mdls).forEach(\n      key => {\n        if (!modules[key]) return\n        let cfg = Object.assign({}, opts, modules[key])\n        this.use(mdls[key], cfg)\n      }\n    )\n\n    this.onReady()\n  }\n\n  get router () { return this._router }\n\n  set router (value) {\n    if (!value) throw new Error('invalid router')\n    this._router = value\n    this.ready = true\n    this.emit('ready')\n  }\n\n  async onReady () {\n    if (this.ready) return this.ready\n    if (this.initing) return this.initing\n\n    this.initing = new Promise(\n      async (resolve, reject) => {\n        this.once('ready', doc => {\n          this.ready = true\n          resolve(this.ready)\n        })\n        delete this.initing\n      }\n    )\n    return this.initing\n  }\n\n  async request (...args) {\n    this.ready || await this.onReady()\n    if (!this.router) throw new Error('invalid router')\n    let opts = utils.preRequest(...args)\n    let sso = this.store.sso || {}\n    if (sso.token) {\n      opts.headers || (opts.headers = {})\n      opts.headers.Authorization = sso.token\n    }\n    const {logger} = this\n    const strRequest = `request:\\n${JSON.stringify(opts, null, 2)}`\n    try {\n      let doc = await this.router.request(opts)\n      logger.debug(`${strRequest}\\nresult:\\n${JSON.stringify(doc, null, 2)}`)\n      return doc\n    } catch (e) {\n      if (e.data && e.data.err === 401 && this.checkLogin) {\n        logger.debug('not login, so checkLogin and try again')\n        sso = await this.checkLogin()\n        if (sso.token) {\n          opts.headers || (opts.headers = {})\n          opts.headers.Authorization = sso.token\n          try {\n            let doc = await this.router.request(opts)\n            logger.debug(`${strRequest}\\nresult:\\n${JSON.stringify(doc, null, 2)}`)\n            return doc\n          } catch (e) {\n            try {\n              const ret = await this.emit('error', e, opts)\n              if (ret !== undefined) {\n                logger.debug(`${strRequest}\\nresult:\\n${JSON.stringify(ret, null, 2)}`)\n                return ret\n              }\n              throw e\n            } catch (ee) {\n              logger.error(`${strRequest}\\nresult:\\n${JSON.stringify(ee.data || null, null, 2)}`)\n              throw ee\n            }\n          }\n        }\n      }\n\n      try {\n        const ret = await this.emit('error', e, opts)\n        if (ret !== undefined) {\n          logger.debug(`${strRequest}\\nresult:\\n${JSON.stringify(ret, null, 2)}`)\n          return ret\n        }\n        throw e\n      } catch (ee) {\n        logger.error(`${strRequest}\\nresult:\\n${JSON.stringify(ee.data || null, null, 2)}`)\n        throw ee\n      }\n    }\n  }\n\n  bindType ($, type, uri = '') {\n    $[type] = async (...args) => {\n      let opts = utils.preRequest(...args)\n      opts.uri = `${uri}${opts.uri}`\n      opts.type = type\n      return this.request(opts)\n    }\n  }\n\n  bind (name, uri) {\n    uri || (uri = '/' + name)\n    let $ = {}\n    event.enableEvent($, {async: true})\n    types.forEach(type => {\n      this.bindType($, type, uri)\n    })\n    this[name] = $\n    return this\n  }\n}\n\nmodule.exports = Sdk\n"],"names":["reservedKeys","Store","opts","keys","validKey","Reflect","configurable","enumerable","get","value","set","Object","d","event","EventEmitter","Err","error","name","app","bind","$","getConfig","root","key","err","FA_PARAMS","setConfig","expire","post","removeConfig","delete","removeRoot","getKeys","getConfigs","setConfigs","unuse","verify","uri","touch","signout","login","username","password","_async","isNaN","checkOrLogin","store","storage","doc","getJson","sso","e","data","token","setJson","doLogin","checkLogin","Promise","resolve","reject","isLoggedIn","logout","removeItem","checkLgoin","then","f","i","length","utils","require$$0","require$$1","types","Sdk","ready","config","forEach","type","bindType","mdls","passport","modules","assign","cfg","use","onReady","initing","once","args","router","Error","preRequest","headers","Authorization","logger","strRequest","JSON","stringify","request","debug","emit","ret","undefined","ee","enableEvent","async","_router","Core"],"mappings":"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"}