{"version":3,"file":"jm-sdk.js","sources":["../lib/config.js","../lib/sso.js","../lib/passport.js","../lib/login.js","../lib/index.js"],"sourcesContent":["const error = require('jm-err')\r\nconst {Err} = error\r\nconst name = 'config'\r\n\r\nmodule.exports = function (opts) {\r\n  let app = this\r\n  this.bind(name)\r\n  const $ = app[name]\r\n\r\n  /**\r\n   * 获取配置\r\n   * @param root 根(必填)\r\n   * @param key 配置项(必填)\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.getConfig = async function (root, key) {\r\n    if (!root || !key) throw error.err(Err.FA_PARAMS)\r\n    return this.get(`/${root}/${key}`)\r\n  }\r\n\r\n  /**\r\n   * 设置配置信息\r\n   * @param root 根(必填)\r\n   * @param key 配置项(必填)\r\n   * @param value 配置值(可选)\r\n   * @param expire 过期时间(可选, 单位秒, 默认0代表永不过期)\r\n   * @returns {Promise<void>}\r\n   */\r\n  $.setConfig = async function (root, key, value, expire = 0) {\r\n    if (!root || !key) throw error.err(Err.FA_PARAMS)\r\n    return this.post(`/${root}/${key}`, {value, expire})\r\n  }\r\n\r\n  /**\r\n   * 删除配置信息\r\n   * @param root 根(必填)\r\n   * @param key 配置项(必填)\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.removeConfig = async function (root, key) {\r\n    if (!root || !key) throw error.err(Err.FA_PARAMS)\r\n    return this.delete(`/${root}/${key}`)\r\n  }\r\n\r\n  /**\r\n   * 删除根配置, 所有根下面的配置信息都被删除\r\n   * @param root 根(必填)\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.removeRoot = async function (root) {\r\n    if (!root) throw error.err(Err.FA_PARAMS)\r\n    return this.delete(`/${root}`)\r\n  }\r\n\r\n  /**\r\n   * 列出配置项, 返回{rows:[]}\r\n   * @param root 根(必填)\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.getKeys = async function (root) {\r\n    if (!root) throw error.err(Err.FA_PARAMS)\r\n    return this.get(`/${root}`)\r\n  }\r\n\r\n  /**\r\n   * 列出配置项及值\r\n   * @param root 根(必填)\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.getConfigs = async function (root) {\r\n    if (!root) throw error.err(Err.FA_PARAMS)\r\n    return this.get(`/${root}?all=1`)\r\n  }\r\n\r\n  /**\r\n   * 设置多个配置信息\r\n   * @param root 根(必填)\r\n   * @param opts\r\n   * @returns {Promise<*>}\r\n   */\r\n  $.setConfigs = async function (root, opts = {}) {\r\n    if (!root) throw error.err(Err.FA_PARAMS)\r\n    return this.post(`/${root}`, {value: opts})\r\n  }\r\n\r\n  return {\r\n    name,\r\n    unuse: () => {\r\n      delete app[name]\r\n    }\r\n  }\r\n}\r\n","const name = 'sso'\r\n\r\nmodule.exports = function (opts) {\r\n  let app = this\r\n  this.bind(name)\r\n  let $ = app[name]\r\n\r\n  $.verify = async function () {\r\n    let uri = '/verify'\r\n    let doc = await this.get(uri)\r\n    return doc\r\n  }\r\n\r\n  $.touch = async function (opts) {\r\n    let uri = '/touch'\r\n    let doc = await this.post(uri)\r\n    return doc\r\n  }\r\n\r\n  $.signout = async function () {\r\n    let uri = '/signout'\r\n    let doc = await this.get(uri)\r\n    return doc\r\n  }\r\n\r\n  return {\r\n    name,\r\n    unuse: () => {\r\n      delete app[name]\r\n    }\r\n  }\r\n}\r\n","const name = 'passport'\r\n\r\nmodule.exports = function (opts) {\r\n  let app = this\r\n  this.bind(name)\r\n  let $ = app[name]\r\n\r\n  $.login = async function (username, password) {\r\n    let uri = '/login'\r\n    let doc = await this.post(uri, {username, password})\r\n    return doc\r\n  }\r\n\r\n  return {\r\n    name,\r\n    unuse: () => {\r\n      delete app[name]\r\n    }\r\n  }\r\n}\r\n","const name = 'login'\r\n\r\nmodule.exports = function (opts) {\r\n  let app = this\r\n  let doLogin = null\r\n\r\n  async function checkOrLogin () {\r\n    let store = app.store\r\n    let storage = app.storage\r\n    let doc = storage.getJson('sso')\r\n    if (doc) {\r\n      store.sso = doc\r\n      try {\r\n        doc = await app.sso.verify()\r\n      } catch (e) {\r\n        doc = e.data || {}\r\n      }\r\n      if (!doc || !doc.token) {\r\n        doc = null\r\n        storage.removeItem('sso')\r\n        delete store.sso\r\n      }\r\n    }\r\n    if (!doc) {\r\n      if (app.login) {\r\n        doc = await app.login()\r\n        if (doc && doc.token) {\r\n          storage.setJson('sso', doc)\r\n          store.sso = doc\r\n        }\r\n      }\r\n    }\r\n    return doc\r\n  }\r\n\r\n  app.checkLogin = async function () {\r\n    if (doLogin) return doLogin\r\n    doLogin = new Promise(\r\n      async (resolve, reject) => {\r\n        try {\r\n          let doc = await checkOrLogin()\r\n          resolve(doc)\r\n        } catch (e) {\r\n          reject(e)\r\n        }\r\n        doLogin = false\r\n      }\r\n    )\r\n    return doLogin\r\n  }\r\n\r\n  /**\r\n   * 判断是否已经登陆\r\n   */\r\n  app.isLoggedIn = function () {\r\n    return this.store.sso\r\n  }\r\n\r\n  /**\r\n   * 登出\r\n   */\r\n  app.logout = function () {\r\n    delete this.store.sso\r\n    this.storage.removeItem('sso')\r\n  }\r\n\r\n  return {\r\n    name,\r\n    unuse: () => {\r\n      delete app.checkLgoin\r\n      delete app.isLoggedIn\r\n      delete app.logout\r\n    }\r\n  }\r\n}\r\n","const event = require('jm-event')\nconst utils = require('jm-ms-core').utils\nconst Core = require('jm-sdk-core')\nconst config = require('./config')\nconst sso = require('./sso')\nconst passport = require('./passport')\nconst login = require('./login')\n\nconst types = ['get', 'post', 'put', 'delete', 'patch']\n\nclass Sdk extends Core {\n  constructor (opts = {}) {\n    super(opts)\n    this.ready = false\n    this.store.config = opts\n\n    types.forEach(type => {\n      this.bindType(this, type)\n    })\n\n    const mdls = {\n      config,\n      sso,\n      passport,\n      login\n    }\n    let modules = Object.assign({}, opts.modules)\n    Object.keys(mdls).forEach(\n      key => {\n        if (!modules[key]) return\n        let cfg = Object.assign({}, opts, modules[key])\n        this.use(mdls[key], cfg)\n      }\n    )\n\n    this.onReady()\n  }\n\n  get router () { return this._router }\n\n  set router (value) {\n    if (!value) throw new Error('invalie router')\n    this._router = value\n    this.ready = true\n    this.emit('ready')\n  }\n\n  async onReady () {\n    if (this.ready) return this.ready\n    if (this.initing) return this.initing\n\n    this.initing = new Promise(\n      async (resolve, reject) => {\n        this.once('ready', doc => {\n          this.ready = true\n          resolve(this.ready)\n        })\n        delete this.initing\n      }\n    )\n    return this.initing\n  }\n\n  async request (...args) {\n    this.ready || await this.onReady()\n    if (!this.router) throw new Error('invalid router')\n    let opts = utils.preRequest(...args)\n    let sso = this.store.sso || {}\n    if (sso.token) {\n      opts.headers || (opts.headers = {})\n      opts.headers.Authorization = sso.token\n    }\n    try {\n      let doc = await this.router.request(opts)\n      let s = `request:\\n${JSON.stringify(opts, null, 2)}\\nresult:\\n${JSON.stringify(doc, null, 2)}`\n      this.logger.debug(s)\n      return doc\n    } catch (e) {\n      if (e.data && e.data.err === 401 && this.checkLogin) {\n        this.logger.debug('not login, so checkLogin and try again')\n        sso = await this.checkLogin()\n        if (sso.token) {\n          opts.headers || (opts.headers = {})\n          opts.headers.Authorization = sso.token\n          try {\n            let doc = await this.router.request(opts)\n            let s = `request:\\n${JSON.stringify(opts, null, 2)}\\nresult:\\n${JSON.stringify(doc, null, 2)}`\n            this.logger.debug(s)\n            return doc\n          } catch (e) {\n            const ret = await this.emit('error', e, opts)\n            if (ret !== undefined) return ret\n            throw e\n          }\n        }\n      }\n      const ret = await this.emit('error', e, opts)\n      if (ret !== undefined) return ret\n      throw e\n    }\n  }\n\n  bindType ($, type, uri = '') {\n    $[type] = async (...args) => {\n      let opts = utils.preRequest(...args)\n      opts.uri = `${uri}${opts.uri}`\n      opts.type = type\n      let doc = await this.request(opts)\n      return doc\n    }\n  }\n\n  bind (name, uri) {\n    uri || (uri = '/' + name)\n    let $ = {}\n    event.enableEvent($, {async: true})\n    types.forEach(type => {\n      this.bindType($, type, uri)\n    })\n    this[name] = $\n    return this\n  }\n}\n\nmodule.exports = Sdk\n"],"names":["Err","error","name","opts","app","bind","$","getConfig","root","key","err","FA_PARAMS","get","setConfig","value","expire","post","removeConfig","delete","removeRoot","getKeys","getConfigs","setConfigs","unuse","verify","uri","touch","signout","login","username","password","_async","checkOrLogin","store","storage","doc","getJson","sso","e","data","token","removeItem","setJson","doLogin","checkLogin","Promise","resolve","reject","isLoggedIn","logout","checkLgoin","then","arguments","utils","require$$0","require$$1","types","Sdk","ready","config","forEach","type","bindType","mdls","passport","modules","Object","assign","keys","cfg","use","onReady","initing","once","args","router","Error","preRequest","headers","Authorization","request","s","JSON","stringify","logger","debug","emit","ret","undefined","event","enableEvent","async","_router","Core"],"mappings":"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"}