{"version":3,"file":"jm-sdk-core.js","sources":["../lib/store.js","../lib/storage.js","../lib/index.js"],"sourcesContent":["const event = require('jm-event')\r\n\r\nconst reservedKeys = [\r\n  '_events',\r\n  '_state',\r\n  'state'\r\n]\r\n\r\nfunction validKey (key) {\r\n  return reservedKeys.indexOf(key) === -1\r\n}\r\n\r\nclass Store extends event.EventEmitter {\r\n  constructor (opts = {}) {\r\n    super(opts)\r\n    this._state = {}\r\n  }\r\n\r\n  listen (...keys) {\r\n    keys.forEach(key => {\r\n      if (!validKey(key)) throw new Error(`${key} can not be listened`)\r\n      Reflect.defineProperty(this, key, {\r\n        configurable: true,\r\n        enumerable: true,\r\n        get: () => {\r\n          const value = this._state[key]\r\n          this.emit('get', key, value)\r\n          return value\r\n        },\r\n        set: value => {\r\n          this._state[key] = value\r\n          this.emit('set', key, value)\r\n        }\r\n      })\r\n    })\r\n    return this\r\n  }\r\n\r\n  get state () {\r\n    let value = Object.assign({}, this._state, this)\r\n    reservedKeys.forEach(key => {\r\n      delete value[key]\r\n    })\r\n    this.emit('get', 'state', value)\r\n    return value\r\n  }\r\n\r\n  set state (value) {\r\n    this.emit('set', 'state', value)\r\n    Object.keys(this).forEach(key => {\r\n      if (!validKey(key)) return\r\n      const d = Reflect.getOwnPropertyDescriptor(this, key)\r\n      if (d && d.set && d.get) return\r\n      delete this[key]\r\n    })\r\n    this._state = {}\r\n    Object.keys(value).forEach(key => {\r\n      this[key] = value[key]\r\n    })\r\n  }\r\n}\r\n\r\nmodule.exports = Store\r\n","const event = require('jm-event')\r\n\r\nclass Store {\r\n  constructor () {\r\n    event.enableEvent(this)\r\n    this.store = {}\r\n  }\r\n\r\n  setItem (k, v) {\r\n    this.emit('setItem', k, v)\r\n    this.store[k] = v\r\n  }\r\n\r\n  getItem (k, defaultV) {\r\n    let v = this.store[k] || defaultV\r\n    this.emit('getItem', k, v)\r\n    return v\r\n  }\r\n\r\n  removeItem (k) {\r\n    this.emit('removeItem', k)\r\n    delete this.store[k]\r\n  }\r\n\r\n  setJson (k, o) {\r\n    this.emit('setJson', k, o)\r\n    this.setItem(k, JSON.stringify(o))\r\n  }\r\n\r\n  getJson (k, defaultV) {\r\n    let v = this.getItem(k)\r\n    if (!v) return defaultV\r\n    let o = JSON.parse(v) || defaultV\r\n    this.emit('getJson', k, o)\r\n    return o\r\n  }\r\n}\r\n\r\nclass Storage {\r\n  constructor () {\r\n    event.enableEvent(this)\r\n  }\r\n\r\n  setItem (k, v) {\r\n    this.emit('setItem', k, v)\r\n    localStorage.setItem(k, v)\r\n  }\r\n\r\n  getItem (k, defaultV) {\r\n    let v = localStorage.getItem(k) || defaultV\r\n    this.emit('getItem', k, v)\r\n    return v\r\n  }\r\n\r\n  removeItem (k) {\r\n    this.emit('removeItem', k)\r\n    localStorage.removeItem(k)\r\n  }\r\n\r\n  setJson (k, o) {\r\n    this.emit('setJson', k, o)\r\n    this.setItem(k, JSON.stringify(o))\r\n  }\r\n\r\n  getJson (k, defaultV) {\r\n    let v = this.getItem(k)\r\n    if (!v) return defaultV\r\n    let o = JSON.parse(v) || defaultV\r\n    this.emit('getJson', k, o)\r\n    return o\r\n  }\r\n}\r\n\r\nlet storage = null\r\nif (typeof localStorage !== 'undefined') {\r\n  storage = new Storage()\r\n} else {\r\n  storage = new Store()\r\n}\r\n\r\nmodule.exports = storage\r\n","const event = require('jm-event')\nconst mdl = require('jm-module')\nconst log = require('jm-logger')\nconst Store = require('./store')\nconst storage = require('./storage')\n\nclass Sdk {\n  constructor (opts = {}) {\n    mdl.enableModule(this)\n    event.enableEvent(this, {async: true})\n    this.logger = opts.logger || log.getLogger('sdk')\n    this.getLogger = opts.getLogger || log.getLogger\n    this.store = opts.store || new Store()\n    this.storage = opts.storage || storage\n  }\n}\n\nmodule.exports = Sdk\n"],"names":["reservedKeys","validKey","key","indexOf","Store","opts","_state","keys","forEach","Error","Reflect","defineProperty","configurable","enumerable","get","value","emit","set","Object","assign","d","getOwnPropertyDescriptor","event","EventEmitter","enableEvent","store","k","v","defaultV","o","setItem","JSON","stringify","getItem","parse","Storage","localStorage","removeItem","storage","Sdk","mdl","enableModule","async","logger","log","getLogger"],"mappings":"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"}