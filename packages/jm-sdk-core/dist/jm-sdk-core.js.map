{"version":3,"file":"jm-sdk-core.js","sources":["../lib/store.js","../lib/storage.js","../lib/index.js"],"sourcesContent":["const event = require('jm-event')\r\n\r\nfunction validKey (key) {\r\n  return [\r\n    'state',\r\n    'on',\r\n    'once',\r\n    'off',\r\n    'emit',\r\n    '_events',\r\n    'eventNames',\r\n    'listeners'\r\n  ].indexOf(key) === -1\r\n}\r\n\r\nconst handler = {\r\n  get: function (target, key, receiver) {\r\n    if (validKey(key)) {\r\n      let value = target.state[key]\r\n      target.emit('get', key, value)\r\n      return value\r\n    }\r\n    return Reflect.get(target, key, receiver)\r\n  },\r\n  set: function (target, key, value, receiver) {\r\n    if (validKey(key)) {\r\n      target.state = Object.assign(target.state, {[key]: value})\r\n      target.emit('set', key, value)\r\n      return true\r\n    }\r\n    return Reflect.set(target, key, value, receiver)\r\n  },\r\n  deleteProperty: function (target, key) {\r\n    if (validKey(key)) {\r\n      delete target.state[key]\r\n      target.emit('remove', key)\r\n      return true\r\n    }\r\n    return Reflect.deleteProperty(target, key)\r\n  }\r\n}\r\n\r\nclass Store {\r\n  constructor (opts = {}) {\r\n    event.enableEvent(this)\r\n    this.state = opts.state || {}\r\n    let doc = new Proxy(this, handler)\r\n    return doc\r\n  }\r\n}\r\n\r\nmodule.exports = Store\r\n","const event = require('jm-event')\r\n\r\nclass Store {\r\n  constructor () {\r\n    event.enableEvent(this)\r\n    this.store = {}\r\n  }\r\n\r\n  setItem (k, v) {\r\n    this.emit('setItem', k, v)\r\n    this.store[k] = v\r\n  }\r\n\r\n  getItem (k, defaultV) {\r\n    let v = this.store[k] || defaultV\r\n    this.emit('getItem', k, v)\r\n    return v\r\n  }\r\n\r\n  removeItem (k) {\r\n    this.emit('removeItem', k)\r\n    delete this.store[k]\r\n  }\r\n\r\n  setJson (k, o) {\r\n    this.emit('setJson', k, o)\r\n    this.setItem(k, JSON.stringify(o))\r\n  }\r\n\r\n  getJson (k, defaultV) {\r\n    let v = this.getItem(k)\r\n    if (!v) return defaultV\r\n    let o = JSON.parse(v) || defaultV\r\n    this.emit('getJson', k, o)\r\n    return o\r\n  }\r\n}\r\n\r\nclass Storage {\r\n  constructor () {\r\n    event.enableEvent(this)\r\n  }\r\n\r\n  setItem (k, v) {\r\n    this.emit('setItem', k, v)\r\n    localStorage.setItem(k, v)\r\n  }\r\n\r\n  getItem (k, defaultV) {\r\n    let v = localStorage.getItem(k) || defaultV\r\n    this.emit('getItem', k, v)\r\n    return v\r\n  }\r\n\r\n  removeItem (k) {\r\n    this.emit('removeItem', k)\r\n    localStorage.removeItem(k)\r\n  }\r\n\r\n  setJson (k, o) {\r\n    this.emit('setJson', k, o)\r\n    this.setItem(k, JSON.stringify(o))\r\n  }\r\n\r\n  getJson (k, defaultV) {\r\n    let v = this.getItem(k)\r\n    if (!v) return defaultV\r\n    let o = JSON.parse(v) || defaultV\r\n    this.emit('getJson', k, o)\r\n    return o\r\n  }\r\n}\r\n\r\nlet storage = null\r\nif (typeof localStorage !== 'undefined') {\r\n  storage = new Storage()\r\n} else {\r\n  storage = new Store()\r\n}\r\n\r\nmodule.exports = storage\r\n","const event = require('jm-event')\nconst mdl = require('jm-module')\nconst log = require('jm-logger')\nconst Store = require('./store')\nconst storage = require('./storage')\n\nclass Sdk {\n  constructor (opts = {}) {\n    mdl.enableModule(this)\n    event.enableEvent(this, {async: true})\n    this.logger = opts.logger || log.getLogger('sdk')\n    this.getLogger = opts.getLogger || log.getLogger\n    this.store = opts.store || new Store()\n    this.storage = opts.storage || storage\n  }\n}\n\nmodule.exports = Sdk\n"],"names":["validKey","key","indexOf","handler","get","target","receiver","value","state","emit","Reflect","set","Object","assign","deleteProperty","Store","opts","event","enableEvent","doc","Proxy","store","k","v","defaultV","o","setItem","JSON","stringify","getItem","parse","Storage","localStorage","removeItem","storage","Sdk","mdl","enableModule","async","logger","log","getLogger"],"mappings":"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"}