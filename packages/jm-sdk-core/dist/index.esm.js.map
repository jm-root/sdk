{"version":3,"file":"index.esm.js","sources":["../lib/store.js","../lib/storage.js","../lib/index.js"],"sourcesContent":["const event = require('jm-event')\r\n\r\nconst reservedKeys = [\r\n  '_events',\r\n  '_state',\r\n  'state'\r\n]\r\n\r\nfunction validKey (key) {\r\n  return reservedKeys.indexOf(key) === -1\r\n}\r\n\r\nclass Store extends event.EventEmitter {\r\n  constructor (opts = {}) {\r\n    super(opts)\r\n    this._state = {}\r\n  }\r\n\r\n  listen (...keys) {\r\n    keys.forEach(key => {\r\n      if (!validKey(key)) throw new Error(`${key} can not be listened`)\r\n      Reflect.defineProperty(this, key, {\r\n        configurable: true,\r\n        enumerable: true,\r\n        get: () => {\r\n          const value = this._state[key]\r\n          this.emit('get', key, value)\r\n          return value\r\n        },\r\n        set: value => {\r\n          this._state[key] = value\r\n          this.emit('set', key, value)\r\n        }\r\n      })\r\n    })\r\n    return this\r\n  }\r\n\r\n  get state () {\r\n    let value = Object.assign({}, this._state, this)\r\n    reservedKeys.forEach(key => {\r\n      delete value[key]\r\n    })\r\n    this.emit('get', 'state', value)\r\n    return value\r\n  }\r\n\r\n  set state (value) {\r\n    this.emit('set', 'state', value)\r\n    Object.keys(this).forEach(key => {\r\n      if (!validKey(key)) return\r\n      const d = Reflect.getOwnPropertyDescriptor(this, key)\r\n      if (d && d.set && d.get) return\r\n      delete this[key]\r\n    })\r\n    this._state = {}\r\n    Object.keys(value).forEach(key => {\r\n      this[key] = value[key]\r\n    })\r\n  }\r\n}\r\n\r\nmodule.exports = Store\r\n","const event = require('jm-event')\r\n\r\nclass Store {\r\n  constructor () {\r\n    event.enableEvent(this)\r\n    this.store = {}\r\n  }\r\n\r\n  setItem (k, v) {\r\n    this.emit('setItem', k, v)\r\n    this.store[k] = v\r\n  }\r\n\r\n  getItem (k, defaultV) {\r\n    let v = this.store[k] || defaultV\r\n    this.emit('getItem', k, v)\r\n    return v\r\n  }\r\n\r\n  removeItem (k) {\r\n    this.emit('removeItem', k)\r\n    delete this.store[k]\r\n  }\r\n\r\n  setJson (k, o) {\r\n    this.emit('setJson', k, o)\r\n    this.setItem(k, JSON.stringify(o))\r\n  }\r\n\r\n  getJson (k, defaultV) {\r\n    let v = this.getItem(k)\r\n    if (!v) return defaultV\r\n    let o = JSON.parse(v) || defaultV\r\n    this.emit('getJson', k, o)\r\n    return o\r\n  }\r\n}\r\n\r\nclass Storage {\r\n  constructor () {\r\n    event.enableEvent(this)\r\n  }\r\n\r\n  setItem (k, v) {\r\n    this.emit('setItem', k, v)\r\n    localStorage.setItem(k, v)\r\n  }\r\n\r\n  getItem (k, defaultV) {\r\n    let v = localStorage.getItem(k) || defaultV\r\n    this.emit('getItem', k, v)\r\n    return v\r\n  }\r\n\r\n  removeItem (k) {\r\n    this.emit('removeItem', k)\r\n    localStorage.removeItem(k)\r\n  }\r\n\r\n  setJson (k, o) {\r\n    this.emit('setJson', k, o)\r\n    this.setItem(k, JSON.stringify(o))\r\n  }\r\n\r\n  getJson (k, defaultV) {\r\n    let v = this.getItem(k)\r\n    if (!v) return defaultV\r\n    let o = JSON.parse(v) || defaultV\r\n    this.emit('getJson', k, o)\r\n    return o\r\n  }\r\n}\r\n\r\nlet storage = null\r\nif (typeof localStorage !== 'undefined') {\r\n  storage = new Storage()\r\n} else {\r\n  storage = new Store()\r\n}\r\n\r\nmodule.exports = storage\r\n","const event = require('jm-event')\nconst mdl = require('jm-module')\nconst log = require('jm-logger')\nconst Store = require('./store')\nconst storage = require('./storage')\n\nclass Sdk {\n  constructor (opts = {}) {\n    mdl.enableModule(this)\n    event.enableEvent(this, {async: true})\n    this.logger = opts.logger || log.getLogger('sdk')\n    this.getLogger = opts.getLogger || log.getLogger\n    this.store = opts.store || new Store()\n    this.storage = opts.storage || storage\n  }\n}\n\nmodule.exports = Sdk\n"],"names":["reservedKeys","validKey","key","indexOf","Store","opts","_state","keys","forEach","Error","Reflect","defineProperty","configurable","enumerable","get","value","emit","set","Object","assign","d","getOwnPropertyDescriptor","event","EventEmitter","enableEvent","store","k","v","defaultV","o","setItem","JSON","stringify","getItem","parse","Storage","localStorage","removeItem","storage","Sdk","mdl","enableModule","async","logger","log","getLogger"],"mappings":"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"}