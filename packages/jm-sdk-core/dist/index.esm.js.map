{"version":3,"file":"index.esm.js","sources":["../lib/store.js","../lib/storage.js","../lib/index.js"],"sourcesContent":["const event = require('jm-event')\r\n\r\nconst reservedKeys = [\r\n  '_events',\r\n  '_state',\r\n  'state'\r\n]\r\n\r\nfunction validKey (key) {\r\n  return reservedKeys.indexOf(key) === -1\r\n}\r\n\r\nclass Store extends event.EventEmitter {\r\n  constructor (opts = {}) {\r\n    super(opts)\r\n    this._state = {}\r\n  }\r\n\r\n  listen (...keys) {\r\n    keys.forEach(key => {\r\n      if (!validKey(key)) throw new Error(`${key} can not be listened`)\r\n      Reflect.defineProperty(this, key, {\r\n        configurable: true,\r\n        enumerable: true,\r\n        get: () => {\r\n          const value = this._state[key]\r\n          this.emit('get', key, value)\r\n          return value\r\n        },\r\n        set: value => {\r\n          this._state[key] = value\r\n          this.emit('set', key, value)\r\n        }\r\n      })\r\n    })\r\n    return this\r\n  }\r\n\r\n  get state () {\r\n    let value = Object.assign({}, this._state, this)\r\n    reservedKeys.forEach(key => {\r\n      delete value[key]\r\n    })\r\n    this.emit('get', 'state', value)\r\n    return value\r\n  }\r\n\r\n  set state (value) {\r\n    this.emit('set', 'state', value)\r\n    Object.keys(this).forEach(key => {\r\n      if (!validKey(key)) return\r\n      const d = Reflect.getOwnPropertyDescriptor(this, key)\r\n      if (d && d.set && d.get) return\r\n      delete this[key]\r\n    })\r\n    this._state = {}\r\n    Object.keys(value).forEach(key => {\r\n      this[key] = value[key]\r\n    })\r\n  }\r\n}\r\n\r\nmodule.exports = Store\r\n","const event = require('jm-event')\r\n\r\nclass Store {\r\n  constructor () {\r\n    event.enableEvent(this)\r\n    this.store = {}\r\n  }\r\n\r\n  setItem (k, v) {\r\n    this.emit('setItem', k, v)\r\n    this.store[k] = v\r\n  }\r\n\r\n  getItem (k, defaultV) {\r\n    let v = this.store[k] || defaultV\r\n    this.emit('getItem', k, v)\r\n    return v\r\n  }\r\n\r\n  removeItem (k) {\r\n    this.emit('removeItem', k)\r\n    delete this.store[k]\r\n  }\r\n\r\n  setJson (k, o) {\r\n    this.emit('setJson', k, o)\r\n    this.setItem(k, JSON.stringify(o))\r\n  }\r\n\r\n  getJson (k, defaultV) {\r\n    let v = this.getItem(k)\r\n    if (!v) return defaultV\r\n    let o = JSON.parse(v) || defaultV\r\n    this.emit('getJson', k, o)\r\n    return o\r\n  }\r\n}\r\n\r\nclass Storage {\r\n  constructor () {\r\n    event.enableEvent(this)\r\n  }\r\n\r\n  setItem (k, v) {\r\n    this.emit('setItem', k, v)\r\n    localStorage.setItem(k, v)\r\n  }\r\n\r\n  getItem (k, defaultV) {\r\n    let v = localStorage.getItem(k) || defaultV\r\n    this.emit('getItem', k, v)\r\n    return v\r\n  }\r\n\r\n  removeItem (k) {\r\n    this.emit('removeItem', k)\r\n    localStorage.removeItem(k)\r\n  }\r\n\r\n  setJson (k, o) {\r\n    this.emit('setJson', k, o)\r\n    this.setItem(k, JSON.stringify(o))\r\n  }\r\n\r\n  getJson (k, defaultV) {\r\n    let v = this.getItem(k)\r\n    if (!v) return defaultV\r\n    let o = JSON.parse(v) || defaultV\r\n    this.emit('getJson', k, o)\r\n    return o\r\n  }\r\n}\r\n\r\nlet storage = null\r\nif (typeof localStorage !== 'undefined') {\r\n  storage = new Storage()\r\n} else {\r\n  storage = new Store()\r\n}\r\n\r\nmodule.exports = storage\r\n","const event = require('jm-event')\nconst mdl = require('jm-module')\nconst log = require('jm-logger')\nconst Store = require('./store')\nconst storage = require('./storage')\n\nclass Sdk {\n  constructor (opts = {}) {\n    mdl.enableModule(this)\n    event.enableEvent(this, {async: true})\n    this.logger = opts.logger || log.getLogger('sdk')\n    this.getLogger = opts.getLogger || log.getLogger\n    this.store = opts.store || new Store()\n    this.storage = opts.storage || storage\n  }\n}\n\nmodule.exports = Sdk\n"],"names":["reservedKeys","validKey","key","indexOf","Store","opts","_state","keys","forEach","Error","Reflect","defineProperty","configurable","enumerable","get","value","emit","set","Object","assign","d","getOwnPropertyDescriptor","event","EventEmitter","enableEvent","store","k","v","defaultV","o","setItem","JSON","stringify","getItem","parse","Storage","localStorage","removeItem","storage","Sdk","mdl","enableModule","async","logger","log","getLogger"],"mappings":"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"}