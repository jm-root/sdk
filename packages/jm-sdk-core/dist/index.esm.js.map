{"version":3,"file":"index.esm.js","sources":["../lib/store.js","../lib/storage.js","../lib/index.js"],"sourcesContent":["const event = require('jm-event')\r\n\r\nfunction validKey (key) {\r\n  return [\r\n    'state',\r\n    'on',\r\n    'once',\r\n    'off',\r\n    'emit',\r\n    '_events',\r\n    'eventNames',\r\n    'listeners'\r\n  ].indexOf(key) === -1\r\n}\r\n\r\nconst handler = {\r\n  get: function (target, key, receiver) {\r\n    if (validKey(key)) {\r\n      let value = target.state[key]\r\n      target.emit('get', key, value)\r\n      return value\r\n    }\r\n    return Reflect.get(target, key, receiver)\r\n  },\r\n  set: function (target, key, value, receiver) {\r\n    if (validKey(key)) {\r\n      target.state = Object.assign(target.state, {[key]: value})\r\n      target.emit('set', key, value)\r\n      return true\r\n    }\r\n    return Reflect.set(target, key, value, receiver)\r\n  },\r\n  deleteProperty: function (target, key) {\r\n    if (validKey(key)) {\r\n      delete target.state[key]\r\n      target.emit('remove', key)\r\n      return true\r\n    }\r\n    return Reflect.deleteProperty(target, key)\r\n  }\r\n}\r\n\r\nclass Store {\r\n  constructor (opts = {}) {\r\n    event.enableEvent(this)\r\n    this.state = opts.state || {}\r\n    let doc = new Proxy(this, handler)\r\n    return doc\r\n  }\r\n}\r\n\r\nmodule.exports = Store\r\n","const event = require('jm-event')\r\n\r\nclass Store {\r\n  constructor () {\r\n    event.enableEvent(this)\r\n    this.store = {}\r\n  }\r\n\r\n  setItem (k, v) {\r\n    this.emit('setItem', k, v)\r\n    this.store[k] = v\r\n  }\r\n\r\n  getItem (k, defaultV) {\r\n    let v = this.store[k] || defaultV\r\n    this.emit('getItem', k, v)\r\n    return v\r\n  }\r\n\r\n  removeItem (k) {\r\n    this.emit('removeItem', k)\r\n    delete this.store[k]\r\n  }\r\n\r\n  setJson (k, o) {\r\n    this.emit('setJson', k, o)\r\n    this.setItem(k, JSON.stringify(o))\r\n  }\r\n\r\n  getJson (k, defaultV) {\r\n    let v = this.getItem(k)\r\n    if (!v) return defaultV\r\n    let o = JSON.parse(v) || defaultV\r\n    this.emit('getJson', k, o)\r\n    return o\r\n  }\r\n}\r\n\r\nclass Storage {\r\n  constructor () {\r\n    event.enableEvent(this)\r\n  }\r\n\r\n  setItem (k, v) {\r\n    this.emit('setItem', k, v)\r\n    localStorage.setItem(k, v)\r\n  }\r\n\r\n  getItem (k, defaultV) {\r\n    let v = localStorage.getItem(k) || defaultV\r\n    this.emit('getItem', k, v)\r\n    return v\r\n  }\r\n\r\n  removeItem (k) {\r\n    this.emit('removeItem', k)\r\n    localStorage.removeItem(k)\r\n  }\r\n\r\n  setJson (k, o) {\r\n    this.emit('setJson', k, o)\r\n    this.setItem(k, JSON.stringify(o))\r\n  }\r\n\r\n  getJson (k, defaultV) {\r\n    let v = this.getItem(k)\r\n    if (!v) return defaultV\r\n    let o = JSON.parse(v) || defaultV\r\n    this.emit('getJson', k, o)\r\n    return o\r\n  }\r\n}\r\n\r\nlet storage = null\r\nif (typeof localStorage !== 'undefined') {\r\n  storage = new Storage()\r\n} else {\r\n  storage = new Store()\r\n}\r\n\r\nmodule.exports = storage\r\n","const event = require('jm-event')\nconst mdl = require('jm-module')\nconst log = require('jm-logger')\nconst Store = require('./store')\nconst storage = require('./storage')\n\nclass Sdk {\n  constructor (opts = {}) {\n    mdl.enableModule(this)\n    event.enableEvent(this, {async: true})\n    this.logger = opts.logger || log.getLogger('sdk')\n    this.getLogger = opts.getLogger || log.getLogger\n    this.store = opts.store || new Store()\n    this.storage = opts.storage || storage\n  }\n}\n\nmodule.exports = Sdk\n"],"names":["validKey","key","indexOf","handler","get","target","receiver","value","state","emit","Reflect","set","Object","assign","deleteProperty","Store","opts","event","enableEvent","doc","Proxy","store","k","v","defaultV","o","setItem","JSON","stringify","getItem","parse","Storage","localStorage","removeItem","storage","Sdk","mdl","enableModule","async","logger","log","getLogger"],"mappings":"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"}